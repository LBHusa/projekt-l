---
phase: 01-security-foundation
plan: 04
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/app/page.tsx
  - src/lib/types/contacts.ts
autonomous: true

must_haves:
  truths:
    - "Homepage loads domain data from database, not hardcoded IDs"
    - "Contact type utilities use database lookup for domain IDs"
    - "No hardcoded domain UUIDs remain in application code"
  artifacts:
    - path: "src/app/page.tsx"
      provides: "Homepage with dynamic domain loading"
      contains: "getDomainByName"
    - path: "src/lib/types/contacts.ts"
      provides: "Contact types with domain lookup utility"
      contains: "getDomainIdByName"
  key_links:
    - from: "src/app/page.tsx"
      to: "life_domains table"
      via: "database query"
      pattern: "from.*life_domains"
    - from: "src/lib/types/contacts.ts"
      to: "life_domains table"
      via: "database query or passed parameter"
      pattern: "getDomainIdByName|domainId.*parameter"
---

<objective>
Remove hardcoded domain UUIDs from homepage and contact types.

Purpose: Complete the removal of hardcoded UUIDs by addressing the remaining locations: src/app/page.tsx (FAMILIE_DOMAIN_ID) and src/lib/types/contacts.ts (domain ID mappings).

Output: All domain references use database lookups or receive domain IDs as parameters from callers who have already fetched them.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-security-foundation/01-RESEARCH.md
@src/lib/data/domains.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix homepage domain reference</name>
  <files>src/app/page.tsx</files>
  <action>
    Current code has:
    ```typescript
    const FAMILIE_DOMAIN_ID = '77777777-7777-7777-7777-777777777777';
    ```

    Replace with dynamic domain loading. First, check if src/lib/data/domains.ts has a getDomainByName function. If not, create one.

    **Option A: If domains.ts has the utility:**
    ```typescript
    import { getDomainByName } from '@/lib/data/domains';

    // In component or data fetching:
    const familieDomain = await getDomainByName('Familie');
    const familieDomainId = familieDomain?.id;
    ```

    **Option B: If utility doesn't exist, create it in domains.ts:**
    ```typescript
    // In src/lib/data/domains.ts
    export async function getDomainByName(name: string): Promise<LifeDomain | null> {
      const supabase = createBrowserClient();
      const { data, error } = await supabase
        .from('life_domains')
        .select('*')
        .eq('name', name)
        .single();

      if (error) {
        console.error('Error fetching domain:', error);
        return null;
      }
      return data;
    }
    ```

    Then use it in page.tsx. If the homepage needs the Familie domain for a specific feature, load it during data fetching instead of using a constant.

    If FAMILIE_DOMAIN_ID is used in a client component, consider:
    1. Fetching domain in a server component and passing as prop
    2. Using a React Query/SWR hook to fetch domain
    3. Creating a useDomain hook that caches the result

    Remove the hardcoded constant entirely.
  </action>
  <verify>Grep for "77777777" in src/app/page.tsx returns no matches</verify>
  <done>Homepage loads Familie domain dynamically from database</done>
</task>

<task type="auto">
  <name>Task 2: Fix contact types domain mapping</name>
  <files>src/lib/types/contacts.ts</files>
  <action>
    Current code has a function that returns hardcoded UUIDs:
    ```typescript
    return '77777777-7777-7777-7777-777777777777'; // Familie Domain
    return 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa'; // Soziales Domain
    ```

    This is a type file that likely shouldn't be doing database lookups. Options:

    **Option A: Remove the function and have callers pass domain ID:**
    If the function is `getDomainIdForCategory(category)`, remove it and update callers to:
    1. Fetch domains at a higher level
    2. Pass domain ID directly

    **Option B: Export a mapping utility that accepts domains:**
    ```typescript
    export function getDomainIdForCategory(
      category: ContactCategory,
      domains: { familie?: string; soziales?: string; karriere?: string }
    ): string | undefined {
      switch (category) {
        case 'family': return domains.familie;
        case 'friend': return domains.soziales;
        case 'colleague': return domains.karriere;
        default: return undefined;
      }
    }
    ```

    **Option C: Create a separate domains utility file:**
    If this function is used in multiple places, create a dedicated utility in `src/lib/data/domains.ts`:
    ```typescript
    // Cache domains in memory after first fetch
    let domainsCache: Record<string, string> | null = null;

    export async function getDomainId(domainName: string): Promise<string | null> {
      if (!domainsCache) {
        const supabase = createBrowserClient();
        const { data } = await supabase.from('life_domains').select('id, name');
        if (data) {
          domainsCache = Object.fromEntries(data.map(d => [d.name, d.id]));
        }
      }
      return domainsCache?.[domainName] ?? null;
    }
    ```

    Choose the option that best fits how the function is currently used. The goal is removing hardcoded UUIDs while maintaining functionality.
  </action>
  <verify>Grep for "77777777|aaaaaaaa|66666666" in src/lib/types/contacts.ts returns no matches</verify>
  <done>Contact types use dynamic domain lookup or parameterized domain IDs</done>
</task>

</tasks>

<verification>
1. `grep -r "77777777-7777-7777-7777-777777777777" src/` returns no matches
2. `grep -r "aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa" src/` returns no matches
3. `grep -r "66666666-6666-6666-6666-666666666666" src/` returns no matches
4. Homepage still functions correctly (Familie data loads)
5. Contact creation still works (domain assignment works)
6. `npx tsc --noEmit` passes with no errors
</verification>

<success_criteria>
- No hardcoded domain UUIDs (77777777, aaaaaaaa, 66666666 patterns) in src/
- Homepage loads domain data dynamically
- Contact domain mapping uses database lookup or parameterized approach
- All existing functionality works (no regressions)
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-security-foundation/01-04-SUMMARY.md`
</output>
