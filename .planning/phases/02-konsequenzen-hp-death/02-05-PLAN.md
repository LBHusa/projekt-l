---
phase: 02-konsequenzen-hp-death
plan: 05
type: execute
wave: 3
depends_on: ["02-02"]
files_modified:
  - src/components/health/HealthBar.tsx
  - src/app/dashboard/page.tsx
autonomous: true

must_haves:
  truths:
    - "User sees HP bar animating smoothly when HP changes"
    - "HP bar color changes based on HP level (green > yellow > red)"
    - "Danger zone (< 20 HP) shows pulsing red warning animation"
    - "Lives are displayed as hearts (filled = alive, empty = lost)"
  artifacts:
    - path: "src/components/health/HealthBar.tsx"
      provides: "Animated HP bar component with Framer Motion"
      exports: ["default"]
      min_lines: 100
    - path: "src/app/dashboard/page.tsx"
      provides: "Dashboard integration of HealthBar"
      contains: "HealthBar"
  key_links:
    - from: "HealthBar component"
      to: "getUserHealth() data"
      via: "Fetch HP state on mount"
      pattern: "getUserHealth"
    - from: "HP bar width"
      to: "Framer Motion animate"
      via: "Percentage-based animation"
      pattern: "motion\\.div.*animate.*width"
---

<objective>
Create animated Health Bar UI component and integrate into dashboard.

Purpose: Give users constant visual feedback on their HP status. The health bar is the primary way users see consequences of their actions (damage) and rewards (healing). It needs to be prominent, animated, and emotionally resonant.

Output: HealthBar component matching existing AttributeBar/HabitStreak patterns, integrated into dashboard header/hero section.
</objective>

<execution_context>
@/root/.claude/get-shit-done/workflows/execute-plan.md
@/root/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/root/husatech/projekt-l/.planning/PROJECT.md
@/root/husatech/projekt-l/.planning/ROADMAP.md
@/root/husatech/projekt-l/.planning/STATE.md
@/root/husatech/projekt-l/.planning/phases/02-konsequenzen-hp-death/02-RESEARCH.md
@/root/husatech/projekt-l/.planning/phases/02-konsequenzen-hp-death/02-01-SUMMARY.md
@/root/husatech/projekt-l/.planning/phases/02-konsequenzen-hp-death/02-02-SUMMARY.md

# Pattern references
@/root/husatech/projekt-l/src/components/factions/AttributeBar.tsx
@/root/husatech/projekt-l/src/app/dashboard/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create HealthBar Component</name>
  <files>src/components/health/HealthBar.tsx</files>
  <action>
Create animated health bar component using Framer Motion, following AttributeBar pattern.

**Component structure:**
```typescript
'use client';

import { motion } from 'framer-motion';
import { Heart, Skull, HeartPulse } from 'lucide-react';
import { useEffect, useState } from 'react';
import { getUserHealth } from '@/lib/data/health';
import type { UserHealth } from '@/lib/database.types';

interface HealthBarProps {
  userId?: string;
  showDetails?: boolean;
  showLives?: boolean;
  className?: string;
}

export default function HealthBar({
  userId,
  showDetails = true,
  showLives = true,
  className = ''
}: HealthBarProps) {
  const [health, setHealth] = useState<UserHealth | null>(null);
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    async function loadHealth() {
      try {
        const data = await getUserHealth(userId);
        setHealth(data);
      } catch (error) {
        console.error('Failed to load health:', error);
      } finally {
        setIsLoading(false);
      }
    }

    loadHealth();
  }, [userId]);

  if (isLoading || !health) {
    return (
      <div className={`animate-pulse bg-gray-800 h-10 rounded-lg ${className}`} />
    );
  }

  const percentage = Math.max(0, Math.min(100, (health.current_hp / health.max_hp) * 100));
  const isDanger = percentage < 20;
  const isLow = percentage < 50;
  const isFlourishing = percentage >= 80;

  const barColor = isDanger
    ? 'bg-red-500'
    : isLow
    ? 'bg-yellow-500'
    : 'bg-green-500';

  const glowColor = isDanger
    ? 'shadow-red-500/50'
    : isLow
    ? 'shadow-yellow-500/50'
    : 'shadow-green-500/50';

  return (
    <div className={`space-y-2 ${className}`}>
      {/* HP Bar */}
      <div className={`relative h-10 bg-gray-800 rounded-lg overflow-hidden border-2 ${
        isDanger ? 'border-red-500' : 'border-gray-700'
      } shadow-lg ${glowColor}`}>
        {/* Fill bar */}
        <motion.div
          className={`h-full ${barColor}`}
          initial={{ width: 0 }}
          animate={{ width: `${percentage}%` }}
          transition={{ duration: 0.5, ease: 'easeOut' }}
        />

        {/* HP Text */}
        <div className="absolute inset-0 flex items-center justify-center">
          <span className="text-white font-bold text-sm drop-shadow-md flex items-center gap-2">
            {isDanger && <HeartPulse className="w-4 h-4 animate-pulse" />}
            {health.current_hp} / {health.max_hp} HP
          </span>
        </div>

        {/* Danger pulse animation */}
        {isDanger && (
          <motion.div
            className="absolute inset-0 bg-red-500 opacity-30 pointer-events-none"
            animate={{ opacity: [0.3, 0.6, 0.3] }}
            transition={{ repeat: Infinity, duration: 1 }}
          />
        )}
      </div>

      {/* Lives display */}
      {showLives && (
        <div className="flex items-center gap-2 justify-center">
          <span className="text-sm text-gray-400">Leben:</span>
          <div className="flex gap-1">
            {Array.from({ length: health.max_lives }).map((_, i) => (
              <Heart
                key={i}
                className={`w-5 h-5 transition-all ${
                  i < health.lives
                    ? 'text-red-500 fill-red-500'
                    : 'text-gray-600 fill-gray-600'
                }`}
              />
            ))}
          </div>
        </div>
      )}

      {/* Status text */}
      {showDetails && (
        <div className="text-center">
          <p className={`text-xs ${
            isDanger ? 'text-red-400' :
            isLow ? 'text-yellow-400' :
            isFlourishing ? 'text-green-400' :
            'text-gray-400'
          }`}>
            {isDanger && '⚠️ Kritischer Zustand - HP dringend auffüllen!'}
            {isLow && !isDanger && 'Niedriger HP-Stand - Vorsicht geboten'}
            {isFlourishing && 'Ausgezeichnete Verfassung!'}
            {!isDanger && !isLow && !isFlourishing && 'Guter Zustand'}
          </p>
        </div>
      )}
    </div>
  );
}
```

**Key features:**
- Framer Motion for smooth width transitions (matches AttributeBar)
- Color-coded by HP level (green/yellow/red)
- Pulsing animation in danger zone (< 20 HP)
- Hearts for lives (filled/empty)
- Auto-loading via getUserHealth()
- Loading skeleton (gray pulse)

**Styling:** Use Tailwind, match existing dark theme, prominent drop shadows.
  </action>
  <verify>
```bash
# TypeScript compilation
cd /root/husatech/projekt-l
npm run build 2>&1 | grep -E "(error|Error)" && echo "BUILD FAILED" || echo "BUILD SUCCESS"

# Check component exports
node -e "import('./src/components/health/HealthBar.js').then(m => console.log('Exported:', m.default ? 'HealthBar' : 'MISSING'))"
```
  </verify>
  <done>
- HealthBar component created with Framer Motion
- Color changes based on HP (green > yellow > red)
- Danger zone shows pulsing red overlay
- Lives displayed as hearts
- Loading state with skeleton
- No TypeScript errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate HealthBar into Dashboard</name>
  <files>src/app/dashboard/page.tsx</files>
  <action>
Add HealthBar to dashboard hero section, positioned prominently above faction cards.

**Integration location:** After the welcome message, before faction stats grid.

```typescript
import HealthBar from '@/components/health/HealthBar';

// ... existing code ...

<div className="space-y-8">
  {/* Welcome section */}
  <div className="text-center space-y-4">
    <h1 className="text-4xl font-bold">Dashboard</h1>
    <p className="text-gray-400">Dein digitaler Spiegel</p>

    {/* NEW: Health Bar */}
    <div className="max-w-md mx-auto mt-6">
      <HealthBar showDetails showLives />
    </div>
  </div>

  {/* Existing faction stats */}
  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {/* ... faction cards ... */}
  </div>
</div>
```

**Styling considerations:**
- max-w-md for readability (not too wide)
- mx-auto to center
- mt-6 spacing from welcome text
- Prominent position - user sees HP immediately on dashboard load

**Responsive:** Should work on mobile (full width on small screens, max-w-md on larger).

Location: Around line 80-100 in dashboard/page.tsx, after user greeting.
  </action>
  <verify>
```bash
# Build check
cd /root/husatech/projekt-l
npm run build

# Visual check (manual)
npm run dev
# Visit http://localhost:3000/dashboard
# Verify: HP bar visible, animates on load, shows lives
```
  </verify>
  <done>
- HealthBar integrated into dashboard hero section
- Positioned above faction stats grid
- Responsive (centered, max-w-md)
- No visual regressions on dashboard
  </done>
</task>

</tasks>

<verification>
**Component functionality:**
- [ ] HealthBar loads HP data on mount
- [ ] HP bar animates from 0% to current %
- [ ] Color changes: green (80%+), yellow (50-80%), red (< 50%)
- [ ] Danger zone (< 20%) shows pulsing overlay
- [ ] Lives render correctly (3 hearts, filled/empty based on lives)
- [ ] Loading state shows skeleton

**Dashboard integration:**
- [ ] HealthBar visible on dashboard
- [ ] Positioned prominently above factions
- [ ] Responsive on mobile and desktop
- [ ] No layout shifts or visual glitches

**Visual test checklist:**
```bash
# Test different HP levels
# 1. Modify user_health.current_hp to 100 -> Green bar
# 2. Modify user_health.current_hp to 45 -> Yellow bar
# 3. Modify user_health.current_hp to 15 -> Red bar with pulse
# 4. Modify user_health.lives to 1 -> Only 1 heart filled
```
</verification>

<success_criteria>
**Must be true after completion:**
- [ ] HealthBar component renders without errors
- [ ] HP bar animates smoothly using Framer Motion
- [ ] Color theming works (green/yellow/red)
- [ ] Danger zone shows pulsing animation
- [ ] Lives displayed as hearts
- [ ] Dashboard shows HealthBar prominently
- [ ] Responsive design works on mobile
- [ ] No TypeScript compilation errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-konsequenzen-hp-death/02-05-SUMMARY.md`
</output>
